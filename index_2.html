<!DOCTYPE html>
<html>
<head>
   <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
   <script src="./supabase.js"></script>
   <meta charset="utf-8">
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <title>HALLOWEEN</title>
   <style type="text/css">
    html{cursor:none;}
      body {
          margin: -20px;
          overflow: hidden;
          position: relative;
          background-image: url(background.jpg);
          background-size: cover;
      }

      #cursor {
          position: absolute;
          pointer-events: none;
          transform: translate(-50%, -50%);
          width: 200px;
          height: 200px;
          z-index: 9999;
      }

      #timer {
          position: fixed;
          top: 10px;
          left: 10px;
          font-family: 'Paperlogy-8ExtraBold';
          font-size: 30px;
          font-weight: bold;
          color: rgb(255, 132, 0);
          z-index: 1000;
      }

      .floating-image {
          position: absolute;
          width: 200px;
          height: 200px;
          z-index: 10;
      }

      #videoPlayer {
          position: fixed;
          top: 0;
          left: 0;
          width: 100vw;
          height: 100vh;
          display: none;
          object-fit: cover;
      }

      .candy {
            position: absolute;
            width: 100px;
            height: 100px;
            cursor: pointer;
            z-index: 0;
        }

         #counter {
            position: fixed;
            top: 50px;
            left: 10px;
            font-size: 24px;
            font-weight: bold;
            color: white;
            font-family: 'Paperlogy-8ExtraBold';
        }

        @font-face {
    font-family: 'Paperlogy-8ExtraBold';
    src: url('https://fastly.jsdelivr.net/gh/projectnoonnu/2408-3@1.0/Paperlogy-8ExtraBold.woff2') format('woff2');
    font-weight: 800;
    font-style: normal;
    }


   </style>
     <style>
        /* ëª¨ë‹¬ì˜ ë°°ê²½ */
        .modal-overlay {
          position: fixed;
          z-index:20;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background: rgba(0, 0, 0, 0.5);
          display: none; /* ê¸°ë³¸ì ìœ¼ë¡œ ìˆ¨ê¹€ */
          justify-content: center;
          align-items: center;
        }
    
        /* ëª¨ë‹¬ ì°½ */
        .modal {
          background: white;
          padding: 20px;
          border-radius: 8px;
          width: 300px;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
          display: flex; /* ì¤‘ì•™ ì •ë ¬ì„ ìœ„í•œ flex ì‚¬ìš© */
          flex-direction: column;
          cursor: move;
        }
    
        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        table {
          width: 100%;
          border-collapse: collapse;
          margin-top: 10px;
          text-align: center;
        }
        table, th, td {
          border: 1px solid #ddd;
        }
        th, td {
          padding: 8px;
          text-align: left;
        }
        th {
          background-color: #f4f4f4;
        }

        .table-container {
        max-height: 300px; /* ìµœëŒ€ ë†’ì´ ì„¤ì • */
        overflow-y: auto;  /* ì„¸ë¡œ ìŠ¤í¬ë¡¤ í™œì„±í™” */
        margin-top: 10px;
        }

        .back-button {
        display: block;
        margin-top: 20px;
        padding: 10px 20px;
        background-color: #ff6600;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        text-align: center;
        }

        .back-button:hover {
        background-color: #cc5200;
        }

      </style>
</head>

<body>
   <div id="cursor">
        <img src="main.gif" alt="cursor" />
    </div>

    <audio id="backgroundMusic" autoplay loop>
    <source src="video_ready/ghost_song.mp3" type="audio/mp3">
    Your browser does not support the audio element.
</audio>
    <div id="timer">30</div>

    <video id="videoPlayer" autoplay>
        <source src="video_ready/ling.mp4" type="video/mp4">

    </video>

    <div id="counter">ğŸ¬: 0</div>

    <div id="modalOverlay" class="modal-overlay">
        <div class="modal">
        <h2>ê²°ê³¼ğŸ¬ğŸ¬ğŸ¬</h2>
        <div class="table-container">
        <table id="userTable">
        <thead>
            <tr>
            <th>ì´ë¦„</th>
            <th>ìŠ¤ì½”ì–´</th>
            </tr>
        </thead>
        <tbody>
            
        </tbody>
        </table>
        <button id="backButton" class="back-button">ë‹¤ì‹œí•˜ê¸°</button> 
        </div>
    </div>

   <script type="text/javascript">
    document.body.addEventListener('click', function() {
            const audio = document.getElementById('backgroundMusic');
            
            audio.volume = 0.5;
            if (audio.paused) {
                audio.play();
            }
        });

    const name = localStorage.getItem("name");
      if (!name) {
        window.location.href = "index.html";
      }

    async function updateUserScore() {
        const name = localStorage.getItem("name");
        if (!name) {
            console.error("ìœ ì €ì´ë¦„ ì™œì—†ì„ê¹Œì‰");
            return;
        }
        localStorage.removeItem("name");
        await db
            .from("score")
            .insert([{ score: clickedCount, name }])
    }
        // ëª¨ë‹¬ ê´€ë ¨ ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
        // ì‚¬ìš©ì ë°ì´í„°ë¥¼ í…Œì´ë¸”ì— ë Œë”ë§
    async function renderUserTable() {
        const modalOverlay = document.getElementById('modalOverlay');
        const userTableBody = document.getElementById('userTable').querySelector('tbody');
        // Supabaseì—ì„œ 'users' í…Œì´ë¸” ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const { data, error } = await db
            .from("score") // í…Œì´ë¸” ì´ë¦„
            .select("*")
            .order('score', { ascending: false })

        if (error) {
            console.error("ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì—ëŸ¬ ë°œìƒ:", error);
            return [];
        }

        
        userTableBody.innerHTML = ""; // ê¸°ì¡´ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”
            data.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                <td>${user.name}</td>
                <td>${user.score}</td>
                `;
                userTableBody.appendChild(row);
            });
        modalOverlay.style.display = 'flex';

    }

    // ëª¨ë‹¬ ë“œë˜ê·¸ ê¸°ëŠ¥ ì¶”ê°€
let modal = document.querySelector('.modal');
let isDragging = false;
let offsetX, offsetY;

modal.addEventListener('mousedown', function(e) {
    isDragging = true;
    offsetX = e.clientX - modal.getBoundingClientRect().left;
    offsetY = e.clientY - modal.getBoundingClientRect().top;
    modal.style.cursor = 'grabbing';
});

document.addEventListener('mousemove', function(e) {
    if (isDragging) {
        let left = e.clientX - offsetX;
        let top = e.clientY - offsetY;
        modal.style.left = left + 'px';
        modal.style.top = top + 'px';
    }
});

document.addEventListener('mouseup', function() {
    isDragging = false;
    modal.style.cursor = 'move';
});



    // ì»¤ì„œ ì´ë™ ê¸°ëŠ¥
    window.onmousemove = function(e) {
        const cursor = document.getElementById('cursor');
        cursor.style.left = e.clientX + "px";
        cursor.style.top = e.clientY + "px";
    };

    // íƒ€ì´ë¨¸ ê¸°ëŠ¥
    let timeLeft = 30;
    const timerElement = document.getElementById('timer');

    function updateTimer() {
        timerElement.textContent = timeLeft;
        if (timeLeft > 0) {
            timeLeft--;
        } else {
            clearInterval(timerInterval);
            (async()=>{
                await updateUserScore()
                await renderUserTable()
            })()
        }
    }

    const timerInterval = setInterval(updateTimer, 1000);

    const images = ['twins.png', 'scream.png', 'ling.png', 'girl.png', 'johnny.png', 'insidius.png', 'nun.png', 'samgak.png', 'saw.png', 'annabelle.png', 'mom.png', 'it.png', 'texas.png', 'terrifier.png'];

    // ê° ì´ë¯¸ì§€ì— ëŒ€í•´ ëœë¤ ì´ë™ ë° ë°˜ì‚¬ íš¨ê³¼ ì ìš©
    const floatingImages = images.map(imageUrl => {
        const imgElement = document.createElement('div');
        imgElement.classList.add('floating-image');
        imgElement.style.backgroundImage = `url(${imageUrl})`;
        document.body.appendChild(imgElement);

        // ëœë¤ ì´ˆê¸° ìœ„ì¹˜ ë° ì†ë„
        let posX = Math.random() * (window.innerWidth - 200);
        let posY = Math.random() * (window.innerHeight - 200);
        let velocityX = 1 + Math.random() * 8;
        let velocityY = 1 + Math.random() * 6;

        return { element: imgElement, posX, posY, velocityX, velocityY, imageUrl };
    });

    // ì´ë¯¸ì§€ ìœ„ì¹˜ ê°±ì‹  ë° ì¶©ëŒ ì²˜ë¦¬
    function moveImages() {
    floatingImages.forEach((image, index) => {
        image.posX += image.velocityX;
        image.posY += image.velocityY;

        // í™”ë©´ì„ ë²—ì–´ë‚˜ì§€ ì•Šë„ë¡ ì²˜ë¦¬
        if (image.posX <= 0 || image.posX >= window.innerWidth - 200) {
            image.velocityX = -image.velocityX;
        }
        if (image.posY <= 0 || image.posY >= window.innerHeight - 200) {
            image.velocityY = -image.velocityY;
        }

        // ìœ„ì¹˜ ê°±ì‹ 
        image.element.style.left = image.posX + 'px';
        image.element.style.top = image.posY + 'px';

        // ì»¤ì„œì™€ ì´ë¯¸ì§€ ê°„ ì¶©ëŒ ê°ì§€
        const cursorX = parseInt(document.getElementById('cursor').style.left);
        const cursorY = parseInt(document.getElementById('cursor').style.top);

        // ë§ˆìš°ìŠ¤ ì»¤ì„œì™€ ì´ë¯¸ì§€ê°€ ê²¹ì¹˜ëŠ”ì§€ í™•ì¸
        if (
            cursorX >= image.posX && cursorX <= image.posX + 100 &&
            cursorY >= image.posY && cursorY <= image.posY + 200
        ) {
               
                if (image.imageUrl === 'ling.png') {
                     const videoPlayer = document.getElementById('videoPlayer');

                // ë¹„ë””ì˜¤ê°€ ì´ë¯¸ ì¬ìƒ ì¤‘ì´ë©´ ì¬ì‹œì‘í•˜ì§€ ì•Šë„ë¡ ë°©ì§€
                    if (videoPlayer.paused) {
                videoPlayer.src = 'video_ready/ling.mp4';
                videoPlayer.style.display = 'block'; // ë¹„ë””ì˜¤ ë³´ì´ë„ë¡ ì„¤ì •
                videoPlayer.play();
                }

                // ë¹„ë””ì˜¤ ì¢…ë£Œ í›„ ìë™ìœ¼ë¡œ ìˆ¨ê¸°ê¸°
                videoPlayer.addEventListener('ended', function() {
                videoPlayer.style.display = 'none';
                });
            }

                if (image.imageUrl === 'girl.png') {
                    const videoPlayer = document.getElementById('videoPlayer');
                    
                if (videoPlayer.paused) {
                videoPlayer.src = 'video_ready/girlhighschool.mp4';
                videoPlayer.style.display = 'block';
                videoPlayer.play();
                audio.volume = 1.3;
                }

                videoPlayer.addEventListener('ended', function() {
                videoPlayer.style.display = 'none';
                });
            }

                if (image.imageUrl === 'johnny.png') {
                    const videoPlayer = document.getElementById('videoPlayer');
                
                if (videoPlayer.paused) {
                videoPlayer.src = 'video_ready/shining.mp4';
                videoPlayer.style.display = 'block';
                videoPlayer.play();
                }

                videoPlayer.addEventListener('ended', function() {
                videoPlayer.style.display = 'none';
                });
            }


                if (image.imageUrl === 'saw.png') {
                    const videoPlayer = document.getElementById('videoPlayer');
                
                if (videoPlayer.paused) {
                videoPlayer.src = 'video_ready/saw.mp4';
                videoPlayer.style.display = 'block';
                videoPlayer.play();
                audio.volume = 1.3;
                }

                videoPlayer.addEventListener('ended', function() {
                videoPlayer.style.display = 'none';
                });
            }


                if (image.imageUrl === 'insidius.png') {
                    const videoPlayer = document.getElementById('videoPlayer');
                    
                if (videoPlayer.paused) {
                videoPlayer.src = 'video_ready/insidius.mp4';
                videoPlayer.style.display = 'block';
                videoPlayer.play();
                }

                videoPlayer.addEventListener('ended', function() {
                videoPlayer.style.display = 'none';
                });
            }

            
                if (image.imageUrl === 'samgak.png') {
                    const videoPlayer = document.getElementById('videoPlayer');
               
               if (videoPlayer.paused) {
                videoPlayer.src = 'video_ready/pyramidhead.mp4';
                videoPlayer.style.display = 'block';
                videoPlayer.play();
                }

                videoPlayer.addEventListener('ended', function() {
                videoPlayer.style.display = 'none';
                });
            }


                if (image.imageUrl === 'nun.png') {
                    const videoPlayer = document.getElementById('videoPlayer');
                
                if (videoPlayer.paused) {
                videoPlayer.src = 'video_ready/nun2.mp4';
                videoPlayer.style.display = 'block';
                videoPlayer.play();
                audio.volume = 1.3;
                }

                videoPlayer.addEventListener('ended', function() {
                videoPlayer.style.display = 'none';
                });
            }

                if (image.imageUrl === 'scream.png') {
                    const videoPlayer = document.getElementById('videoPlayer');
                    
                if (videoPlayer.paused) {
                videoPlayer.src = 'video_ready/scream.mp4';
                videoPlayer.style.display = 'block';
                videoPlayer.play();
                }

                videoPlayer.addEventListener('ended', function() {
                videoPlayer.style.display = 'none';
                });
            }

                if (image.imageUrl === 'twins.png') {
                    const videoPlayer = document.getElementById('videoPlayer');
                
                if (videoPlayer.paused) {
                videoPlayer.src = 'video_ready/shining_twins.mp4';
                videoPlayer.style.display = 'block';
                videoPlayer.play();
                audio.volume = 1.3;
                }

                videoPlayer.addEventListener('ended', function() {
                videoPlayer.style.display = 'none';
                });
            }

            if (image.imageUrl === 'texas.png') {
                    const videoPlayer = document.getElementById('videoPlayer');
                
                if (videoPlayer.paused) {
                videoPlayer.src = 'video_ready/texas.mp4';
                videoPlayer.style.display = 'block';
                videoPlayer.play();
                }

                videoPlayer.addEventListener('ended', function() {
                videoPlayer.style.display = 'none';
                });
            }
            
            if (image.imageUrl === 'mom.png') {
                    const videoPlayer = document.getElementById('videoPlayer');
                
                if (videoPlayer.paused) {
                videoPlayer.src = 'video_ready/mom.mp4';
                videoPlayer.style.display = 'block';
                videoPlayer.play();
                }

                videoPlayer.addEventListener('ended', function() {
                videoPlayer.style.display = 'none';
                });
            }

            if (image.imageUrl === 'it.png') {
                    const videoPlayer = document.getElementById('videoPlayer');
                
                if (videoPlayer.paused) {
                videoPlayer.src = 'video_ready/it.mp4';
                videoPlayer.style.display = 'block';
                videoPlayer.play();
                }

                videoPlayer.addEventListener('ended', function() {
                videoPlayer.style.display = 'none';
                });
            }

            if (image.imageUrl === 'annabelle.png') {
                    const videoPlayer = document.getElementById('videoPlayer');
                
                if (videoPlayer.paused) {
                videoPlayer.src = 'video_ready/annabelle.mp4';
                videoPlayer.style.display = 'block';
                videoPlayer.play();
                }

                videoPlayer.addEventListener('ended', function() {
                videoPlayer.style.display = 'none';
                });
            }

            if (image.imageUrl === 'terrifier.png') {
                    const videoPlayer = document.getElementById('videoPlayer');
                
                if (videoPlayer.paused) {
                videoPlayer.src = 'video_ready/terrifier.mp4';
                videoPlayer.style.display = 'block';
                videoPlayer.play();
                }

                videoPlayer.addEventListener('ended', function() {
                videoPlayer.style.display = 'none';
                });
            }

            
            }
        });
    }

 const screenWidth = window.innerWidth;
        const screenHeight = window.innerHeight;

        const candyImages = ['candy1.png', 'candy2.png', 'candy3.png', 'candy4.png'];

        var clickedCount = 0;

        function updateCounter() {
            const counterElement = document.getElementById('counter');
            counterElement.textContent = `ğŸ¬ : ${clickedCount}`;
        }

        // ë¬´ì‘ìœ„ë¡œ ì´ë¯¸ì§€ ë°°ì¹˜í•˜ëŠ” í•¨ìˆ˜
        function createRandomCandy() {
            const candy = document.createElement('div');
            candy.classList.add('candy');

            // ë¬´ì‘ìœ„ ì´ë¯¸ì§€ ì„ íƒ
            const randomImage = candyImages[Math.floor(Math.random() * candyImages.length)];
            candy.style.backgroundImage = `url('${randomImage}')`;
            candy.style.backgroundSize = 'cover';

            // ë¬´ì‘ìœ„ ìœ„ì¹˜ ì„¤ì •
            const posX = Math.random() * (screenWidth - 100); // í™”ë©´ ë„ˆë¹„ì—ì„œ ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ë¹¼ì„œ ìœ„ì¹˜ ì¡°ì •
            const posY = Math.random() * (screenHeight - 100); // í™”ë©´ ë†’ì´ì—ì„œ ì´ë¯¸ì§€ í¬ê¸°ë¥¼ ë¹¼ì„œ ìœ„ì¹˜ ì¡°ì •

            candy.style.left = `${posX}px`;
            candy.style.top = `${posY}px`;

            // í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
            candy.addEventListener('click', function() {
                candy.remove();
                clickedCount++;
                updateCounter();
            });

            // ì´ë¯¸ì§€ ì¶”ê°€
            document.body.appendChild(candy);
        }

        // ì´ë¯¸ì§€ë¥¼ ì—¬ëŸ¬ ê°œ ì¶”ê°€ (ì˜ˆ: 20ê°œ)
        for (let i = 0; i < 80; i++) {
            createRandomCandy();
        }
    // 16ms ë§ˆë‹¤ ì´ë¯¸ì§€ ìœ„ì¹˜ ê°±ì‹ 
    setInterval(moveImages, 16);

    document.getElementById('backButton').addEventListener('click', function() {
    window.location.href = 'index.html';  // index.htmlë¡œ ì´ë™
});

</script>
</body>
</html>
